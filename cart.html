<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart - Sari-Sari Store</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="mb-4 text-center">Your Cart</h2>
  <div id="cart-items"></div>
  <div class="mt-3 text-end">
    <h4>Total: ₱<span id="cart-total">0.00</span></h4>
    <a href="checkout.html" class="btn btn-success mt-2">Proceed to Checkout</a>
  </div>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function saveCart() {
  localStorage.setItem("cart", JSON.stringify(cart));
}

function updateCheckoutButton() {
  const checkoutBtn = document.querySelector("a[href='checkout.html']");
  if (!checkoutBtn) return;

  if (cart.length === 0) {
    checkoutBtn.classList.add("disabled");
    checkoutBtn.setAttribute("aria-disabled", "true");
  } else {
    checkoutBtn.classList.remove("disabled");
    checkoutBtn.setAttribute("aria-disabled", "false");
  }
}

function displayCart() {
  const container = document.getElementById("cart-items");
  container.innerHTML = "";
  let total = 0;

  if (cart.length === 0) {
    // Show empty cart message
    container.innerHTML = `
      <div class="text-center py-5">
        <h4>Your cart is empty</h4>
        <a href="index.html" class="btn btn-primary mt-3">Shop Now</a>
      </div>
    `;
    document.getElementById("cart-total").innerText = "0.00";
    updateCheckoutButton();
    return;
  }

  cart.forEach((item, i) => {
    let finalPrice = item.price;
    if(item.discount){
      if(item.discount.includes("%")){
        finalPrice = finalPrice * (1 - parseFloat(item.discount)/100);
      } else {
        finalPrice = finalPrice - parseFloat(item.discount);
      }
    }
    total += finalPrice * item.qty;

    const displayImage = item.image_url && item.image_url.trim() !== "" 
                         ? item.image_url.trim() 
                         : 'https://dummyimage.com/80x80/cccccc/ffffff.png&text=No+Image';

    container.innerHTML += `
      <div class="d-flex justify-content-between align-items-center border-bottom py-2">
        <div class="d-flex align-items-center">
          <img src="${displayImage}" width="50" height="50" class="me-2"
               onerror="this.onerror=null;this.src='https://dummyimage.com/50x50/cccccc/ffffff.png&text=No+Image'">
          <div>
            <strong>${item.product_name}</strong><br>
            ₱${finalPrice.toFixed(2)} x ${item.qty}
          </div>
        </div>
        <div>
          <button class="btn btn-sm btn-primary me-1" onclick="increaseQty(${i})">+</button>
          <button class="btn btn-sm btn-primary me-1" onclick="decreaseQty(${i})">-</button>
          <button class="btn btn-sm btn-danger" onclick="removeItem(${i})">Remove</button>
        </div>
      </div>`;
  });

  document.getElementById("cart-total").innerText = total.toFixed(2);
  saveCart();
  updateCheckoutButton();
}

function increaseQty(i) {
  cart[i].qty += 1;
  displayCart();
}

function decreaseQty(i) {
  if(cart[i].qty > 1) {
    cart[i].qty -= 1;
  } else {
    cart.splice(i, 1);
  }
  displayCart();
}

function removeItem(i) {
  cart.splice(i, 1);
  displayCart();
}

// Initial render
displayCart();
</script>
</script>
</body>
</html>