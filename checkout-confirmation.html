<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Confirmation - Sari-Sari Store</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {background:#f8f9fa;}
.container {max-width:1100px;}
.confirmation-header {text-align:center; margin-bottom:30px;}
.confirmation-header h2 {font-weight:700; color:#198754;}
.confirmation-header .checkmark {font-size:50px; color:#198754;}
.checkout-container {display:flex; flex-wrap:wrap; gap:20px;}
.left, .right {background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.left {flex:1; min-width:300px;}
.right {width:350px;}
.card-summary h5 {font-weight:600; margin-bottom:15px;}
.total {font-size:1.2rem; font-weight:700;}
.text-muted small {font-size:0.85rem;}
</style>
</head>
<body>
<div class="container py-4">

  <div class="confirmation-header">
    <div class="checkmark">&#10004;</div>
    <h2>Thank you!</h2>
    <p>Your order is confirmed. You’ll receive a confirmation email soon.</p>
  </div>

  <div class="checkout-container">

    <!-- LEFT: Customer Info -->
    <div class="left">
      <h5>Order Details</h5>
      <div class="mb-3">
        <strong>Contact Information:</strong><br>
        <span id="customer-name"></span><br>
        <span id="customer-email"></span><br>
        <span id="customer-mobile"></span>
      </div>

      <div class="mb-3">
        <strong>Room No:</strong><br>
        <span id="room-number"></span>
      </div>

      <div class="mb-3">
        <strong>Payment Method:</strong><br>
        <span id="payment-method"></span>
      </div>

      <div class="mb-3">
        <strong>Billing Address:</strong><br>
        <span id="billing-address"></span>
      </div>

      <a href="index.html" class="btn btn-primary w-100">Continue Shopping</a>
    </div>

    <!-- RIGHT: Order Summary -->
    <div class="right">
      <h5 class="card-summary">Your Order</h5>
      <div id="cart-items" class="mb-3"></div>

      <div class="d-flex justify-content-between"><span>Subtotal</span><span id="subtotal">₱0.00</span></div>
      <div class="d-flex justify-content-between"><span>Shipping</span><span id="shipping">₱0.00</span></div>
      <div class="d-flex justify-content-between"><span>Taxes</span><span id="taxes">₱0.00</span></div>
      <hr>
      <div class="d-flex justify-content-between total"><span>Total</span><span id="total">₱0.00</span></div>
      <div class="text-success mt-1" id="total-savings"></div>
    </div>

  </div>
</div>

<script>
// Get order data from localStorage
let urlParams = new URLSearchParams(window.location.search);
let orderId = urlParams.get("orderId");
let orderData = JSON.parse(localStorage.getItem("lastOrder"));

// Validate order
if(!orderData){
  alert("Order not found!");
  window.location.href = "index.html";
}

// Support BOTH old (cart) and new (items) structure
let cartItems = orderData.items || orderData.cart || [];

console.log("Order Loaded:", orderData);

// Populate left column
document.getElementById("customer-name").innerText = orderData.customer_name || "";
document.getElementById("customer-email").innerText = orderData.email_id || "";
document.getElementById("room-number").innerHTML = `Room: ${orderData.room_number || ""}`;
document.getElementById("customer-mobile").innerText = orderData.mobile || "";
document.getElementById("billing-address").innerHTML = `Room: ${orderData.room_number || ""}`;
document.getElementById("payment-method").innerText = orderData.payment_method || "";

// Populate right column (order summary)
const cartEl = document.getElementById("cart-items");
cartEl.innerHTML = "";

let subtotal = 0;
let savings = 0;

cartItems.forEach(item=>{
  let price = item.price;
  let discountAmount = 0;

  if(item.discount){
    discountAmount = item.discount.includes("%")
      ? price * parseFloat(item.discount)/100
      : parseFloat(item.discount);
    price -= discountAmount;
    savings += discountAmount * item.qty;
  }

  subtotal += price * item.qty;

  let imgSrc = item.image_url && item.image_url.trim() !== ""
    ? item.image_url
    : 'https://dummyimage.com/50x50/cccccc/ffffff.png&text=No+Image';

  cartEl.innerHTML += `
    <div class="d-flex mb-2 align-items-center">
      <img src="${imgSrc}" width="50" class="me-2"
           onerror="this.onerror=null; this.src='https://dummyimage.com/50x50/cccccc/ffffff.png&text=No+Image'">
      <div class="flex-grow-1">
        ${item.product_name}<br>
        <small>${item.qty} × ${price.toFixed(2)}</small>
      </div>
      <div>${(price*item.qty).toFixed(2)}</div>
    </div>
  `;
});

// Use stored totals if available
document.getElementById("subtotal").innerText = subtotal.toFixed(2);
document.getElementById("shipping").innerText = (orderData.shipping_cost || 0).toFixed(2);
document.getElementById("taxes").innerText = (orderData.taxes || 0).toFixed(2);
document.getElementById("total").innerText = (orderData.total || subtotal).toFixed(2);
document.getElementById("total-savings").innerText =
  savings > 0 ? `TOTAL SAVINGS ${savings.toFixed(2)}` : "";

// Clear cart (safe)
localStorage.removeItem("cart");
</script>
</body>
</html>